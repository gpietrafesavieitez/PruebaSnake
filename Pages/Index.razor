@page "/"
@using PruebaSnake.Data;

<table runat="server">
    @for (int j = 0; j < MyBoard.TabY; j++)
    {
        <tr id="@j">
            @for (int i = 0; i < MyBoard.TabX; i++)
            {
                // Hay una serpiente
                if (MySnake.Check(new Pixel(i, j)))
                {
                    <td id="@i">[S]</td>
                }

                // La manzana y la cabeza de la serpiente chocan
                else if (MySnake.Head.PosX == MyApple.PosX && MySnake.Head.PosY == MyApple.PosY)
                {
                    CreateApple();
                    MySnake.Grow();
                }

                // Hay una manzana
                else if (MyApple.PosX == i && MyApple.PosY == j)
                {
                    <td id="@i">[A]</td>
                }

                // La cabeza de la serpiente choca con el tablero
                else if (
                        MySnake.Head.PosX < 0
                    ||  MySnake.Head.PosX >= MyBoard.TabX
                    ||  MySnake.Head.PosY < 0
                    ||  MySnake.Head.PosY >= MyBoard.TabY
                    )
                {
                    TimerStop();
                }

                // La cabeza de la serpiente choca con una parte de su cuerpo
                else if (MySnake.IsCrashing)
                {
                    TimerStop();
                }

                // Hay otra cosa
                else
                {
                    <td id="@i">[_]</td>
                }
            }
        </tr>
    }
</table>
<input id="controls" class="txtControl mb-2" type="text" placeholder="Controla con las flechas" @onkeydown="KeyboardEventHandler"/>
<button class="btn btn-primary" @onclick="TimerStart">Jugar</button>

@code {
    private void KeyboardEventHandler(KeyboardEventArgs args)
    {
        if(args.Key == "ArrowLeft" && Dir != Direction.RIGHT)
        {
            Dir = Direction.LEFT;
        }
        else if (args.Key == "ArrowUp" && Dir != Direction.DOWN)
        {
            Dir = Direction.UP;
        }
        else if (args.Key == "ArrowRight" && Dir != Direction.LEFT)
        {
            Dir = Direction.RIGHT;
        }
        else if (args.Key == "ArrowDown" && Dir != Direction.UP)
        {
            Dir = Direction.DOWN;
        }
    }
}